<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Add Choices</title>
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.0/dist/litera/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script>
        function addChoice() {
            const container = document.getElementById("choices");
            container.insertAdjacentHTML('beforeend', `
                <div class="mb-3">
                    <input name="choice" class="form-control my-1" placeholder="Choice label" required>
                    <input name="description" class="form-control fst-italic" placeholder="Description (optional)">
                </div>
            `);
        }
    </script>
</head>
<body class="bg-light">
<div class="container py-5">
    <h2>Add choices to collective decision "{{ name }}"</h2>
    <form method="post">
        <div id="choices">
            <div class="mb-3">
                <input name="choice" class="form-control my-1" placeholder="Choice label" required>
                <input name="description" class="form-control fst-italic" placeholder="Description (optional)">
            </div>
        </div>
        <button type="button" class="btn btn-secondary mb-3" onclick="addChoice()">+ Add Choice</button>

        <!--
        <h5 class="mt-4">Choose an Evaluation Scale (comma-separated)</h5>
        <input name="scale" class="form-control mb-3" value="Pas du tout, Un peu, Beaucoup, À la folie !">
        -->
        <h5 class="mt-4">Choose an Evaluation Scale</h5>
        <div id="scale-container" class="form-control mb-3 d-flex flex-wrap">
            <input type="text" id="scale-input" class="border-0 flex-grow-1" placeholder="Type a label and press Enter">
        </div>
        <input type="hidden" name="scale" id="scale-hidden" value="Pas du tout, Un peu, Beaucoup, À la folie !">



        <button type="submit" name="done" class="btn btn-primary">Finish and Share</button>
    </form>
</div>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const container = document.getElementById("scale-container");
  const input = document.getElementById("scale-input");
  const hidden = document.getElementById("scale-hidden");

  let values = hidden.value.split(",").map(s => s.trim()).filter(Boolean);
  renderTags();

  input.addEventListener("keydown", function (e) {
    if (e.key === "Enter" && input.value.trim()) {
      e.preventDefault();
      values.push(input.value.trim());
      input.value = "";
      renderTags();
    }
  });

  function renderTags() {
    // clear existing tags (but keep input at the end)
    container.querySelectorAll(".tag").forEach(el => el.remove());

    const colors = generateColors(values.length);
    values.forEach((val, idx) => {
      const tag = document.createElement("span");
      tag.className = "tag";
      tag.style.backgroundColor = colors[idx];
      tag.textContent = val;

      const removeBtn = document.createElement("span");
      removeBtn.className = "remove";
      removeBtn.innerHTML = "&times;";
      removeBtn.onclick = () => {
        values.splice(idx, 1);
        renderTags();
      };

      tag.appendChild(removeBtn);
      container.insertBefore(tag, input);
    });

    hidden.value = values.join(", ");
  }


    function generateColors(n) {
        // Red → Yellow → Green
        let colors = [];
        for (let i = 0; i < n; i++) {
            let ratio = i / (n - 1); // 0 → 1
            let r, g, b;

            if (ratio < 0.5) {
                // Red (220,53,69) → Yellow (255,193,7)
                let t = ratio / 0.5;
                r = Math.round(220 + (255 - 220) * t);
                g = Math.round(53 + (193 - 53) * t);
                b = Math.round(69 + (7 - 69) * t);
            } else {
                // Yellow (255,193,7) → Green (25,135,84)
                let t = (ratio - 0.5) / 0.5;
                r = Math.round(255 + (25 - 255) * t);
                g = Math.round(193 + (135 - 193) * t);
                b = Math.round(7 + (84 - 7) * t);
            }
            colors.push(`rgb(${r},${g},${b})`);
        }
        return colors;
    }
});
</script>


</body>
</html>